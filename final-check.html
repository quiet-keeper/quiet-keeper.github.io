<!DOCTYPE html>
<html>
<head>
    <title>Последний Рубеж</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Courier New', monospace; background: #111; color: #ddd; max-width: 700px; margin: 50px auto; padding: 30px; border: 1px solid #333; }
        h1 { color: #8a8; border-bottom: 1px solid #444; padding-bottom: 10px; }
        label { display: block; margin-top: 20px; color: #aaa; }
        input, textarea { width: 100%; background: #222; color: #ccc; border: 1px solid #444; padding: 10px; margin-top: 5px; font-family: inherit; }
        button { background: #333; color: #8a8; border: 1px solid #555; padding: 10px 25px; margin-top: 25px; cursor: pointer; }
        button:hover { background: #3a3a3a; }
        .message { margin-top: 20px; padding: 15px; background: #1a2a1a; border: 1px solid #383; display: none; }
    </style>
</head>
<body>
    <h1>Последний Рубеж</h1>
    <p>Автоматические механизмы отключены. Дальше нужно идти пешком.</p>
    <p><strong>Задание:</strong> 
    <p> Пространство на Земле никак не отличается от космического. За пределами взоров обычных людей есть место где кто-то ждёт ответа со звёзд пока не раствориться в пустоте одиночества. Ты прошел долгий путь. Вложи душу, свои мысли  
        <label>Ключ доступа (тот, что ты получил в конце):</label>
        <input type="text" id="key" name="key" required>

        const body = `Ключ: ${key}\n\nОтвет:\n${essay}\n\n---\n\n[Если хочешь получить ответ — приложи к своему письму СВОЙ открытый PGP-ключ или свой Session ID.]`;
        <label>Твой ответ:</label>
        <textarea id="essay" name="essay" rows="6" required></textarea>

        <button type="submit">Сгенерировать сигнал</button>
    </form>

    <div id="successMessage" class="message">
        <h3>Сигнал сформирован.</h3>
        <p>Чтобы он дошёл, тебе нужно:</p>
        <ol>
            <li>Открыть свой почтовый клиент (или зайти на ProtonMail/Tutanota).</li>
            <li>Создать новое письмо на адрес: <br><strong><code id="targetEmail">izuzapasnow@gmail.com</code></strong></li>
            <li>Скопировать и вставить <strong>Тему</strong> и <strong>Текст</strong> письма из полей ниже.</li>
            <li>Отправить.</li>
        </ol>
        <p><strong>Тема письма:</strong><br>
        <code id="mailSubject" style="display:block; background:#222; padding:10px; margin:5px 0; word-break:break-all;"></code></p>
        <p><strong>Текст письма:</strong><br>
        <textarea id="mailBody" style="width:100%; height:150px; background:#222; color:#ccc; border:1px solid #444; padding:10px; margin:5px 0;" readonly></textarea></p>
        <p><em>Сигнал будет считаться отправленным только после этого.</em></p>
    </div>

    <script>
        const EXPECTED_KEYWORD = "resonance";
        const YOUR_EMAIL = "izuzapasnow@gmail.com";

        const form = document.getElementById('finalForm');
        const successDiv = document.getElementById('successMessage');
        const subjectField = document.getElementById('mailSubject');
        const bodyField = document.getElementById('mailBody');
        const emailField = document.getElementById('targetEmail');

        emailField.textContent = YOUR_EMAIL;

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            const key = document.getElementById('key').value.trim();
            const essay = document.getElementById('essay').value.trim();

            if (!key.includes(EXPECTED_KEYWORD)) {
                alert('Ключ не распознан.');
                return;
            }

            const subject = `Сигнал: ${key.slice(0, 15)}`;
            const body = `Ключ: ${key}\n\nОтвет:\n${essay}\n\n---\n`;

            subjectField.textContent = subject;
            bodyField.value = body;
            successDiv.style.display = 'block';
            form.style.display = 'none';

            const copyButton = document.createElement('button');
            copyButton.textContent = 'Скопировать текст письма';
            copyButton.style.marginTop = '10px';
            copyButton.onclick = function() {
                bodyField.select();
                document.execCommand('copy');
                alert('Текст скопирован в буфер обмена.');
            };
            bodyField.parentNode.appendChild(copyButton);
        });
    </script>
